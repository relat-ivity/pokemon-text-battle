# DeepSeek AI 对战系统

## 简介

本系统集成了 DeepSeek AI，让你可以与真正的大语言模型进行宝可梦对战！AI 会基于实时战场信息分析局势并做出决策。

## 安装步骤

### 1. 安装依赖

```bash
npm install
```

### 2. 获取 DeepSeek API 密钥

1. 访问 [DeepSeek 官网](https://platform.deepseek.com/)
2. 注册账号并登录
3. 在控制台创建 API 密钥
4. 复制你的 API 密钥

### 3. 设置环境变量

#### 方法一：使用 .env 文件（推荐）

这是最简单的方法，无需设置系统环境变量：

1. 复制 `.env.example` 文件为 `.env`：
   ```bash
   copy .env.example .env
   ```

2. 用文本编辑器打开 `.env` 文件，将 `your_api_key_here` 替换为你的实际 API 密钥：
   ```
   DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   ```

3. 保存文件，直接运行即可：
   ```bash
   npm run battle
   ```

#### 方法二：临时设置环境变量（当前会话有效）

**Windows (PowerShell):**
```powershell
$env:DEEPSEEK_API_KEY="你的API密钥"
npm run battle
```

**Windows (CMD):**
```cmd
set DEEPSEEK_API_KEY=你的API密钥
npm run battle
```

**Linux / macOS:**
```bash
export DEEPSEEK_API_KEY="你的API密钥"
npm run battle
```

## 使用方法

### 启动对战

```bash
node pve-battle.js
```

- **如果设置了 API 密钥**：使用 DeepSeek AI 对战
- **如果没有设置 API 密钥**：自动回退到本地智能 AI

### AI 决策流程

1. **收集战场信息**
   - 双方宝可梦状态（HP、属性、能力变化、状态异常）
   - 可用招式（威力、命中率、PP、属性、效果描述）
   - 特性和携带道具
   - 太晶化状态

2. **AI 分析**
   - DeepSeek AI 会分析当前局势
   - 考虑属性克制、招式威力、命中率
   - 评估 HP 状况和能力变化
   - 决定最优行动

3. **执行决策**
   - AI 会显示思考过程和理由
   - 执行选定的招式或切换宝可梦

### 提示词示例

系统提示词

```txt
你是一名宝可梦对战专家，精通单打对战策略。
【任务】
现在是宝可梦全球对战的决赛现场，你的目标是夺得冠军。这是你最后一次参加比赛，每一步都务必谨慎思考，如果输掉这场比赛你就再也没机会参加了。
你需要根据计算公式和克制关系、现有的情报以及各种列出的考虑因素，选择胜率最高的行动方案。
【输出格式】只输出一句指令
【重要】你有时候可以获得对手的操作，请你根据对手的操作信息做出压制。
【伤害计算】我会在提示词中提供精确的伤害计算结果，伤害用满血的百分比表示（包括我方全队对对手的伤害、对手对我方的伤害）。**必须使用这些精确数据**做决策。
伤害计算已考虑所有修正值（STAB、属性克制、天气、能力变化等）。
```

提示词

```txt
 当前要选择下一回合的操作。指令格式：move X（使用第X个招式）、move X terastallize（使用第X个招式并太晶化）、switch X（切换到第X个宝可梦）
【考虑因素】
0. 【**重要**】如果获得了对手的这回合的操作信息，请优先通过太晶化反制、换人联攻联防、使用针对招式或者抓住时机强化来反制对手的选择
1. 注意伤害计算：根据上面的伤害公式计算伤害和承受伤害
2. 【**关键**】属性克制和招式威力
3. 注意根据双方速度个体值判断先后手，考虑会不会被对方先手击败
4. 剩余宝可梦状态和HP
5. 注意场地效果和天气影响
6. 判断是否需要使用太晶化进攻或者防守
7. 预判对手行为
下面是当前双方状态：
=== 当前战场状态 ===
【我方队伍】
1. 拉帝欧斯 [当前出战] 属性:[龙/超能] HP:100% 特性:飘浮 道具:心之水滴 速度:350 太晶:钢 招式: 流星群, 精神噪音, 快速折返, 自我再生
2. 烈腿蝗 属性:[虫/恶] HP:100% 特性:有色眼镜 道具:厚底靴 速度:283 太晶:虫 招式: 迎头一击, 急速折返, 拍落, 突袭
3. 桃歹郎 属性:[毒/幽灵] HP:100% 特性:毒傀儡 道具:厚底靴 速度:219 太晶:恶 招式: 邪毒锁链, 欺诈, 抛下狠话, 自我再生
4. 藏玛然特 属性:[格斗] HP:100% 特性:不屈之盾 道具:厚底靴 速度:412 太晶:火 招式: 近身战, 咬碎, 尖石攻击, 冰冻牙
5. 古鼎鹿 属性:[恶/地面] HP:100% 特性:灾祸之鼎 道具:吃剩的东西 速度:130 太晶:幽灵 招式: 隐形岩, 吹飞, 地震, 大灾难
6. 天蝎王 属性:[地面/飞行] HP:100% 特性:毒疗 道具:剧毒宝珠 速度:225 太晶:水 招式: 撒菱, 拍落, 急速折返, 守住
【对手队伍】
1. 雄伟牙 [当前出战] 属性:[地面/格斗] HP:100% 特性:古代活性 道具:厚底靴 速度:300 太晶:钢 招式: 突飞猛扑, 冰旋, 高速旋转, 隐形岩
2. 达克莱伊 属性:[恶] HP:100% 特性:梦魇 道具:吃剩的东西 速度:383 太晶:毒 招式: 恶之波动, 冰冻光束, 诡计, 鬼火
3. 厄诡椪(Ogerpon-Wellspring) 属性:[草/水] HP:100% 特性:储水 道具:水井面具 速度:350 太晶:水 招式: 棘藤棒, 强力鞭打, 拍落, 急速折返
4. 赛富豪 属性:[钢/幽灵] HP:100% 特性:黄金之躯 道具:气球 速度:225 太晶:妖精 招式: 暗影球, 魔法闪耀, 诡计, 自我再生
5. 快龙 属性:[龙/飞行] HP:100% 特性:多重鳞片 道具:厚底靴 速度:205 太晶:一般 招式: 神速, 地震, 龙尾, 羽栖
6. 古鼎鹿 属性:[恶/地面] HP:100% 特性:灾祸之鼎 道具:吃剩的东西 速度:130 太晶:水 招式: 地震, 大灾难, 吹飞, 撒菱
【当前出战】拉帝欧斯 可太晶化: 钢
【可选动作】
使用招式:
  move 1: 流星群 [龙/特殊] - Lowers the user's Sp. Atk by 2.
  move 2: 精神噪音 [超能/特殊] - For 2 turns, the target is prevented from healing.
  move 3: 快速折返 [水/物理] - User switches out after damaging the target.
  move 4: 自我再生 [一般/变化] - Heals the user by 50% of its max HP.
切换宝可梦:
  switch 2: 烈腿蝗 [虫/恶] HP:283/283
  switch 3: 桃歹郎 [毒/幽灵] HP:380/380
  switch 4: 藏玛然特 [格斗] HP:325/325
  switch 5: 古鼎鹿 [恶/地面] HP:514/514
  switch 6: 天蝎王 [地面/飞行] HP:352/352
提示: 可以在使用招式时同时太晶化（例如：move 1 tera）

【重要情报】对手的操作：使用第 4 个招式【隐形岩】（岩石/变化）

=== 伤害计算结果 ===
【我方全队 → 对手当前在场的雄伟牙】
1. 拉帝欧斯 [当前出战] 流星群：113.2%-133.4% [一击必杀!] 精神噪音：131.0%-154.2% [一击必杀!] 快速折返：15.1%-18.3%
2. 烈腿蝗 迎头一击：29.1%-34.5% 急速折返：22.6%-27.0% 拍落：31.8%-37.2% 突袭：22.6%-27.0%
3. 桃歹郎 邪毒锁链：21.6%-25.3% 欺诈：11.1%-13.2%
4. 藏玛然特 近身战：39.6%-46.9% 咬碎：8.9%-10.5% 尖石攻击：5.4%-6.5% 冰冻牙：29.1%-34.5%
5. 古鼎鹿 地震：25.1%-29.9% 大灾难：无效
6. 天蝎王 拍落：7.0%-8.4% 急速折返：5.1%-6.2%
【对手当前在场的雄伟牙 → 我方全队】
1. 对拉帝欧斯 [当前出战] 突飞猛扑：无效 冰旋：70.4%-83.1% 高速旋转：21.9%-25.9%
2. 对烈腿蝗 突飞猛扑：42.4%-50.2% 冰旋：37.8%-44.9% 高速旋转：24.0%-28.3%
3. 对桃歹郎 突飞猛扑：54.2%-64.7% 冰旋：12.1%-14.5% 高速旋转：无效
4. 对藏玛然特 突飞猛扑：36.3%-42.8% 冰旋：16.0%-19.1% 高速旋转：10.5%-12.3%
5. 对古鼎鹿 突飞猛扑：31.7%-37.5% 冰旋：28.4%-33.5% 高速旋转：8.9%-10.7%
6. 对天蝎王 突飞猛扑：无效 冰旋：80.7%-95.5% 高速旋转：12.8%-15.1%
```

AI响应结果

```txt
ParseAIResponse:  move 1 使用流星群直接击败雄伟牙阻止其撒钉，信息中有【重要情报】对手使用隐形岩

【对手】 拉帝欧斯 使用了 流星群
  → 【你】 雄伟牙 受到伤害! (HP: 0 fnt)
  → 【对手】 拉帝欧斯 的特攻下降了 2 级!
  → 【你】 雄伟牙 倒下了!
```

## 注意事项

1. **API 费用**
   - DeepSeek API 需要付费使用
   - 每次对战约调用 10-30 次 API
   - 建议在官网查看当前费率

2. **网络要求**
   - 需要稳定的网络连接
   - 每次决策需要 2-5 秒响应时间
   - 如果超时（10秒），会自动使用备用 AI

3. **API 调用限制**
   - 注意 API 的速率限制
   - 如果频繁调用可能触发限流

## 自定义配置

### 修改 AI 行为

编辑 `deepseek-ai.js` 中的系统提示词：

```javascript
const systemPrompt = `你是一个宝可梦对战专家。你需要根据当前战场状态...`;
```

### 调整对话历史长度

```javascript
...this.conversationHistory.slice(-6), // 保留最近3轮（改为 -10 保留5轮）
```

### 修改超时时间

```javascript
timeout: 10000 // 10秒超时（修改为其他值，单位：毫秒）
```

## 进阶使用

### 使用其他 AI 模型

修改 `deepseek-ai.js`：

```javascript
model: 'deepseek-chat', // 改为其他模型名称
```

### 调整 AI 创造性

```javascript
temperature: 0, // 0.0-2.0，值越高越有创造性
```

祝你对战愉快！

